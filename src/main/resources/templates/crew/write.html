<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>

<!--    <link rel="canonical" href="https://getbootstrap.kr/docs/5.1/examples/checkout/">-->
<!--    &lt;!&ndash; Bootstrap core CSS &ndash;&gt;-->
<!--    <link href="/docs/5.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="/docs/5.1/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="mask-icon" href="/docs/5.1/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="/docs/5.1/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }
        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
        .container {
            max-width: 960px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container">
    <main>
        <div class="py-5 text-center">

            <h2>🎉 운동메 모집하기</h2>
            <p class="lead">간단한 모임을 이루어 다양한 사람들과 운동하기</p>
        </div>
        <div class="row">
            <div class="col">
                <h4 class="mb-3">운동메 모집 양식</h4>
                <form class="needs-validation" novalidate>
                    <div class="row g-3">
                        <input type="radio" class="btn-check" name="options-outlined" id="success-outlined" autocomplete="off" value="축구">
                        <label class="btn btn-outline-success" for="success-outlined">축구</label>

                        <input type="radio" class="btn-check" name="options-outlined" id="danger-outlined" autocomplete="off" value="농구">
                        <label class="btn btn-outline-danger" for="danger-outlined">농구</label>

                        <div class="col-12">
                            <label for="title" class="form-label">운동메 제목</label>
                            <input type="text" class="form-control" id="title" placeholder="모임하고싶은 이름" required>
                            <div class="invalid-feedback">
                                제목을 입력하세요!
                            </div>
                        </div>

                        <div class="col-12">
                            <label for="content" class="form-label">세부 내용입력<span class="text-muted">(Optional)</span></label>
                            <textarea class="form-control" id="content" placeholder="모임의 세부내용"></textarea>
                        </div>

                    </div>

                    <hr class="my-4">

                    <tr>
                        <th>주소</th>
                        <td><input type="text" id="address_kakao" name="address" readonly /></td>
                    </tr>
                    <tr>
                        <th>상세 주소</th>
                        <td><input type="text" id="address_detail" name="address_detail" /></td>
                    </tr>

                    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
                    <script>
                        window.onload = function(){
                            document.getElementById("address_kakao").addEventListener("click", function(){ //주소입력칸을 클릭하면
                                //카카오 지도 발생
                                new daum.Postcode({
                                    oncomplete: function(data) { //선택시 입력값 세팅
                                        document.getElementById("address_kakao").value = data.address; // 주소 넣기
                                        document.querySelector("input[name=address_detail]").focus(); //상세입력 포커싱
                                    }
                                }).open();
                            });
                        }
                    </script>

                    <hr class="my-4">

                    <label class="form-label" id="rangeHuman">인원수</label>
                    <input type="range" class="form-range" min="1" max="99" step="1" id="customRange3" onchange="changeLabel()">

                    <hr class="my-4">

                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="same-address">
                        <label class="form-check-label" for="same-address">성향</label>
                    </div>

                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="save-info">
                        <label class="form-check-label" for="save-info">성향</label>
                    </div>

                    <hr class="my-4">

                    <h4 class="mb-3">우리는 이런 모임입니다</h4>

                    <div class="my-3">
                        <div class="form-check">
                            <input id="credit" name="paymentMethod" type="radio" class="form-check-input" checked required>
                            <label class="form-check-label" for="credit">타입1</label>
                        </div>
                        <div class="form-check">
                            <input id="debit" name="paymentMethod" type="radio" class="form-check-input" required>
                            <label class="form-check-label" for="debit">타입2</label>
                        </div>
                        <div class="form-check">
                            <input id="paypal" name="paymentMethod" type="radio" class="form-check-input" required>
                            <label class="form-check-label" for="paypal">타입3</label>
                        </div>
                    </div>

                    <hr class="my-4">


                </form>
                <button class="w-100 btn btn-primary btn-lg" id="writeBtn" onclick="crewMake()">💪모임 시작하기</button>
                <br>
                <button class="w-100 btn btn-primary btn-lg" id="backBtn">조금 더 둘러보기</button>
            </div>
        </div>
    </main>

</div>

<script>
    document.getElementById('backBtn').addEventListener('click',back);
    function back(){
        location.href="/view/v1/crews";
    }

    async function chatRoomMake(crewId){
        let response = await fetch("/api/v1/room", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({
                crewId: crewId,
                name: document.getElementById("title").value
            })
        })
        console.log(response);
        if(response.ok){
            let json = await response.json()
            console.log(json);
            alert("채팅등록");
        }else{
            let json = await response.text();
            console.log(json);
            alert("실패");
        }
    }

   async function crewMake() {
       let choose = document.querySelector('input[type=radio][name=options-outlined]:checked').value;

       if(choose === null){
           console.log("error not choose");
           return;
       }
       console.log("start");
        let response = await fetch("/api/v1/crews", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include",
            body: JSON.stringify({
                strict: document.getElementById("address_kakao").value+ " " + document.getElementById("address_detail").value,
                crewLimit: document.getElementById("customRange3").value,
                content: document.getElementById("content").value,
                title: document.getElementById("title").value,
                sports: choose
            })
        })
        console.log(response);
        if(response.ok){
            let json = await response.json()
            console.log(json);
            alert("모임등록성공!");
            let crewId = json.result.crewId;
            chatRoomMake(crewId);
            location.href="/view/v1/crews";
        }else{
            let json = await response.text();
            console.log(json);
        }
    }

    function changeLabel(){
        document.getElementById('rangeHuman').innerHTML = "인원수 " + document.getElementById('customRange3').value ;
    }

</script>

</body>
</html>